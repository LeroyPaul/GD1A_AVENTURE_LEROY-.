<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" /><title>The Legend of Canard : a Canard to the Past</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.51.0/dist/phaser.js">
    </script>

    <style type="text/css"> body 
    
        { margin: 0; 
        }
        
    
    </style>
</head>
<body>
    <script type="text/javascript">


class scene1 extends Phaser.Scene{
    constructor(){
        super("scene 1");
    }

preload(){

    this.load.image("phaser_background", "assets/essai decor.png");

    this.load.tilemapTiledJSON("carte", "map.json");  

    this.load.spritesheet('marcheDroite','assets/anim canard marche droite.png',{ frameWidth: 32, frameHeight: 32 });
    this.load.spritesheet('marcheGauche','assets/anim canard marche gauche.png',{ frameWidth: 32, frameHeight: 32 });
    this.load.spritesheet('marcheArriere','assets/anim canard marche arriere.png',{ frameWidth: 32, frameHeight: 35 });
    this.load.spritesheet('marcheAvant','assets/anim canard marche avant.png',{ frameWidth: 32, frameHeight: 35 });
    this.load.spritesheet('bougePasAvant','assets/anim canard bouge pas avant.png',{ frameWidth: 32, frameHeight: 32 });

    this.load.spritesheet('monstreArrière','assets/anim canard bouge pas avant.png',{ frameWidth: 32, frameHeight: 32 });



}


create(){

//Variable

this.attaque = false;
this.compteurAttaqueTemps = 40;
this.direction = "bas"






    const carteDuNiveau = this.add.tilemap("carte");


// importer TileSet 
    const tileset = carteDuNiveau.addTilesetImage(
        "test",
        "phaser_background",
    );
// importez les layers 1 apr 1 dans l'ordre d'apparition
    const layer1 = carteDuNiveau.createStaticLayer(
                    "mur",
                    tileset,
                    );  
    const layer2 = carteDuNiveau.createStaticLayer(
                    "sol",
                    tileset,
                    );  



this.physics.world.setBounds(0, 0, 3200, 3200);





    this.player = this.physics.add.sprite(100,100,"bougePasAvant");
    layer1.setCollisionByProperty({ EstSolide: true });
    this.physics.add.collider(this.player, layer1);
    
    
    
    this.player.setSize(15, 13);
    this.player.setOffset(9, 20);

    this.ennemi = this.physics.add.sprite(200,200,"bougePasAvant");

    this.cameras.main.zoom = 2;
    this.cameras.main.startFollow(this.player);

    
    
    this.anims.create({
                key: 'animMarcheDroite',
                frames: this.anims.generateFrameNumbers('marcheDroite', {start:0,end:5}),
                frameRate: 8,
                repeat: -1
            });

    this.anims.create({
                key: 'animMarcheGauche',
                frames: this.anims.generateFrameNumbers('marcheGauche', {start:0,end:5}),
                frameRate: 8,
                repeat: -1
            });

    this.anims.create({
                key: 'animMarcheArriere',
                frames: this.anims.generateFrameNumbers('marcheArriere', {start:0,end:5}),
                frameRate: 8,
                repeat: -1
            });

    this.anims.create({
                key: 'animMarcheAvant',
                frames: this.anims.generateFrameNumbers('marcheAvant', {start:0,end:5}),
                frameRate: 8,
                repeat: -1
            });

    this.anims.create({
                key: 'animBougePasAvant',
                frames: this.anims.generateFrameNumbers('bougePasAvant', {start:0,end:7}),
                frameRate: 8,
                repeat: -1
            });
            


            this.cursors = this.input.keyboard.createCursorKeys();
            this.keys = this.input.keyboard.addKeys({
                q:  Phaser.Input.Keyboard.KeyCodes.Q,
                d:  Phaser.Input.Keyboard.KeyCodes.D,
                z:  Phaser.Input.Keyboard.KeyCodes.Z,
                s:  Phaser.Input.Keyboard.KeyCodes.S,
                m:  Phaser.Input.Keyboard.KeyCodes.M,
            });


        this.physics.add.overlap( this.player, this.ennemi, this.attaqueEnnemi, null,this);
}

update(){

    //Déplacement vertical
    if (this.cursors.up.isDown || this.keys.z.isDown){
        this.direction = "haut"
            if (this.cursors.down.isDown || this.keys.s.isDown) {
                this.player.setVelocityY(0);
                this.direction = "haut"
            }
            else {
                if (this.player.body.velocity.x != 0) {
                    this.player.setVelocityY(-150);
                } else {
                    this.player.setVelocityY(-200);
                }
            }
        }
        else if (this.cursors.down.isDown || this.keys.s.isDown){
            this.direction = "bas"
            if (this.player.body.velocity.x != 0) {
                    this.player.setVelocityY(150);
                } else {
                    this.player.setVelocityY(200);
                }
        }
        else {this.player.setVelocityY(0);}
        //Déplacement horizontal
        if (this.cursors.left.isDown || this.keys.q.isDown){
            this.direction = "gauche"
            if (this.cursors.right.isDown || this.keys.d.isDown) {
                this.direction = "bas"
                this.player.setVelocityX(0);
            }
            else {
                if (this.player.body.velocity.y != 0) {
                    this.player.setVelocityX(-150);
                } else {
                    this.player.setVelocityX(-200);
                }
            }
        }
        else if (this.cursors.right.isDown || this.keys.d.isDown){
            this.direction = "droite"
            if (this.player.body.velocity.y != 0) {
                    this.player.setVelocityX(150);
                } else {
                    this.player.setVelocityX(200);
                }
        }
        else {
            this.player.setVelocityX(0);
            }
            



        // ANIMATION (pas du tout pompe sur zelda)



        if (this.player.body.velocity.x > 0){
            this.player.anims.play('animMarcheDroite', true);
        }

        if (this.player.body.velocity.y < 0){
            this.player.anims.play('animMarcheArriere', true);
        }

        if (this.player.body.velocity.x < 0){
            this.player.anims.play('animMarcheGauche', true);
        }

        if (this.player.body.velocity.y > 0){
            this.player.anims.play('animMarcheAvant', true);
        }
        
        if(this.player.body.velocity.x==0){
            if (this.player.body.velocity.y==0){
                if (this.attaque == false){
                        this.player.anims.play('animBougePasAvant', true);
                        }
                    }
                }


        // ACTIONS PARTICULIERES

       if(this.keys.m.isDown){
           this.attaque = true
       }

       if (this.attaque == true){
        
            if (this.direction == "droite"){
                this.player.anims.play('animMarcheDroite', true);
                this.player.setSize(25, 30);
                this.player.setOffset(20, 0);}
            if (this.direction == "gauche"){
                this.player.anims.play('animMarcheGauche', true);
                this.player.setSize(25, 30);
                this.player.setOffset(-15, 0);}

            if (this.direction == "haut"){
                this.player.anims.play('animMarcheArriere', true);
                this.player.setSize(25, 25);
                this.player.setOffset(4, -15);}

            if (this.direction == "bas"){
                this.player.anims.play('animMarcheAvant', true);
                this.player.setSize(25, 25);
                this.player.setOffset(4, 25);}
            

                    this.compteurAttaqueTemps -=1 ;
                    if(this.compteurAttaqueTemps == 0){
                        this.compteurAttaqueTemps = 40;
                        this.attaque = false ;
                        this.player.setSize(15, 13);
                        this.player.setOffset(9, 20);
            }
       }

}

attaqueEnnemi (player,ennemi){
        if (this.attaque==true){
            ennemi.destroy();
        }
        if (this.attaque==false){
            player.setTint(0xffffff);
        }
    }




};




var config = {
        type: Phaser.AUTO,
        width: 960, height: 540,
        physics: {
        default: 'arcade',
        arcade: {
        debug: true
        }},
        pixelArt: true,
        roundPixel: true,
        scene: [scene1]
        };
        new Phaser.Game(config);


</script>
</body>
</html>